﻿﻿@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<AppointmentData>

@using DotNetNuke.Web.Client.ClientResourceManagement
@using DotNetNuke.Framework.JavaScriptLibraries
@using Dnn.Appointment.Debug.DnnAppointmentDebug.Services
@using Dnn.Appointment.Debug.DnnAppointmentDebug.Models;

@{
    ClientResourceManager.RegisterScript(Dnn.DnnPage, "~/DesktopModules/MVC/DnnAppointmentDebug/Scripts/Scripts.js");
    ClientResourceManager.RegisterStyleSheet(Dnn.DnnPage, "~/DesktopModules/MVC/DnnAppointmentDebug/Content/Index.css");

    var appointments = ViewBag.Appointments as AppointmentData[]
?? new AppointmentData[] { };
    }

<div class="moduleWrapper">
    <div class="col-md-12 moduleHeader">
        <h1 class="moduleHeaderText">Foglaljon időpontot még ma!</h1>
    </div>
    <div class="col-md-12 moduleContainer">
        <div class="col-md-9">
            <div class="textLabel">
                <p>Miért érdemes időpontot foglalnia?</p>
            </div>
            <div class="textContainer">
                <p>Looking to elevate your Porsche driving experience? Book an appointment with our expert tuning advisors for persionalized guidance and recommendations tailored to your needs. Whether you're seeking performance enhancements or aesthetic upgrades, we're here to help you unlock the full potential of you Porsche. Schedule your appointment today and embark on the journey to unleash the power and style of your Porsche!</p>
            </div>
            <div class="appointmentTextContainer">
                <p>Időpontjai</p>
            </div>
            @if (appointments.Length == 0)
            {
                <p>Ön még nem foglalt időpontot</p>
            }
            else
            {
                <div class="appointmentListContainer">
                    @foreach (var item in appointments)
                    {
                        <div class="appointment-item">
                            <div class="appointment-itemText">
                                <p>@(item.User.Email)</p>
                                <p>@(item.Date.DateTime.ToLongDateString())&emsp;@(item.Date.StartTime.ToString("HH")):@(item.Date.StartTime.ToString("mm")) - @(item.Date.EndTime.ToString("HH")):@(item.Date.EndTime.ToString("mm"))</p>
                            </div>
                            <button type="button" id="delete-@item.AppointmentID" class="appointment-secondary-button" onclick="$.deleteappointment(@item.AppointmentID)">Törlés</button>
                        </div>
                    }
                </div>
                    }
                </div>
        <div class="createContainer col-md-3">
            <div class="createTextContainer">
                <p class="createText">Foglaljon időpontot</p>
            </div>
            <div class="createButtonContainer">
                <button type="button" class="createButton" onclick="@Url.Action("Create","AppointmentBooking",new {ctl = "Create", })">Időpontfoglalás</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    /*globals jQuery, window, Sys */
    (function ($, Sys) {
        $(function () {
            $(document).ready(function () {
                var sf = $.ServicesFramework('@Dnn.ActiveModule.ModuleID');
                this.baseUrl = sf.getServiceRoot('AppointmentBookingAppointment');
            })

            $.deleteappointment = function (cancelid) {
                var check = confirm("Biztosan törölni szeretné a foglalást?")
                if (check) {
                    var deleteproxy = new AppointmentProxy(
                    '@Dnn.ActiveModule.ModuleID',
                    'AppointmentBookingAppointment'
                    );
                    deleteproxy.cancel(cancelid, () => { window.location.reload() })
                }
            }
            }
        )
    })(jQuery, window.Sys);
</script>